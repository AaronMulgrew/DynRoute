<html>
<head>
    <title>Leaflet.js Demo</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/css/normalize.css">
    <link rel="stylesheet" href="/static/css/skeleton.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <script src="MovingMarker.js"></script>
    <script src="/static/javascript/traffic_control.js"></script>

    <script type="text/javascript">
        {% if session['auth_token'] %}
            var AuthToken = " {{ session['auth_token'] }} "
            init({{AuthToken }});
        {% endif %}
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style type="text/css">
        html, body {
            height: 100%;
        }

        #map {
            height: 60%;
        }

        #slidecontainer {
            #margin-top: 60%;
            width: 90%;
        }
    </style>

</head>
<body>
    {% block content %}
    {% if name %}
    <h1>Hello {{ name }}!</h1>
    {% endif %}
    {% if error %}
    <h1>Error! {{ error }}!</h1>
    {% endif %}
    {% if session['logged_in'] %}

    {% if data %}
    <h3>Hello {{data}}</h3>
    {% endif %}


    <a class="button" href="/logout">Logout</a> <br> <br>

    {% else %}
    <p>Not Logged in!</p>
    <a class="button" href="/login">Login</a>
    {% endif %}
    {% endblock %}


    <div id="map"></div>
    <div id="slidecontainer">
        <input type="range" min="200" max="3000" value="3000" class="slider" id="myRange">
        <p>Value: <span id="demo"></span></p>
    </div>
    <div id="junctionToggle">
        <button onclick="PrepShowJunction()">Show Junctions</button>
        <button onclick="HideJunctions()">Hide Junctions</button>
        {% if session['logged_in'] %}
        <button onclick="GenerateEmergency()">Dispatch Emergency Vehicle</button>
        {% endif %}
    </div>

    <script type="text/javascript">
        var map = L.map('map').setView([52.635897, -1.132896], 15);
        var markers = []
        var showJunctions = false
        var JuncInterval = 1000
        L.tileLayer('https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'OSM' })
            .addTo(map);
        var juncIcon = L.icon({
            iconUrl: 'junc_icon.png',
            iconSize: [32, 32],
            shadowSize: [0, 0]
        });

        var slider = document.getElementById("myRange");
        var output = document.getElementById("demo");
        output.innerHTML = slider.value;

        slider.oninput = function () {
            getNewCarsInterval = this.value;
            output.innerHTML = getNewCarsInterval;
            clearInterval(interval);
            interval = 0;
            interval = window.setInterval(function () {
                httpGetAsync("/", process_coord);
            }, getNewCarsInterval);
        }
        var interval = window.setInterval(function () {
            httpGetAsync("/", process_coord);
        }, 1000);
    </script>

</body>
</html>